import { Meta } from "@storybook/addon-docs";
import { Sandpack } from "@codesandbox/sandpack-react"

<Meta title="Getting Started" />

---

You can use the components anywhere you use HTML, either natively (see
[Using a CDN](#using_a_cdn) or [Using modules](#using_modules)), or with a library like React (see [Using a library or framework](#usage_with_popular_libraries_and_frameworks)).

## Using a CDN

All the components are compiled down to ES5 before being distributed via
[jsDelivr](https://jsdelivr.com). In order to resolve imports modules use an [import map](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script/type/importmap).

### Polyfill

If you are not using a modern browser you may have to use a [polyfill](https://github.com/guybedford/es-module-shims) for the import maps.

### Dependency

Most components use D3js. Instead of bundling the library with every component,
we thought it would be better to load it separately, so you will need to add it
like this:

```html
<script src="https://cdn.jsdelivr.net/npm/d3@7.8.2" defer></script>
```

### Display your first component

Using a component is as easy as importing it to your HTML and using it like you
would a regular HTML tag. Let's display the `nightingale-sequence` component:

<Sandpack 
      template="vanilla"
      files={{
        "/index.js": `<script type="importmap">
  {
    "imports": {
      "@nightingale-elements/": "https://cdn.jsdelivr.net/npm/@nightingale-elements/"
    }
  }
</script>
<script type="module">
  import "@nightingale-elements/nightingale-sequence@latest";
  import "@nightingale-elements/nightingale-track@latest";
</script>
<nightingale-sequence
  sequence="SEQUENCESEQUENCESEQUENCESEQUENCE"
  width="800"
  height="40"
  length="32"
  display-start="10"
  display-end="20"
  highlight="3:15"
  id="my-nightingale-sequence-id"
></nightingale-sequence>
}`,
      }}
    />

### Setting the data through property

```js
<nightingale-track
  id="my-track-id"
  length="223"
  height="100"
  display-start="1"
  display-end="50"
  layout="non-overlapping"
></nightingale-track>


const track = document.querySelector("#my-track-id");
track.data = myDataObject;
```

### Event listening
The component should fire events of the type change, and the detail object should contain the attributes type and value to the parent element.

```js
this.dispatchEvent(
  new CustomEvent("change", {
    detail: {
      value: "New value",
      type: "attr1",
    },
  })
);
```

## Usage with popular libraries and frameworks

Since this project relies on a web standard, namely
[custom-elements](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_custom_elements), its use should be made easier and cross-library bugs and
unwanted interactions should be reduced grandly.

Depending on the library or framework you are using, you might want to consider
[having a look here](https://custom-elements-everywhere.com/) to check possible
pitfalls and consider workarounds.

### React

If you decide to use your own data loaders, the recommended way is to use `ref`s
so you can then use the component's API to deal with asynchronicity:

```js
...
const trackContainer = useRef(null);

useEffect(()=> {
  if(trackContainer) {
    trackContainer.current.data = data;
  }
}, [data]);


return <nightingale-track
  ref={trackContainer}
  id="my-track-id"
  length="223"
  height="100"
  display-start="1"
  display-end="50"
  layout="non-overlapping"
></nightingale-track>
...
```

Or you can decided to use a helper component that would bridge the gap between
the React way of doing things and the standard Custom Element's:

- [`<ReactPropertySetter />` to set properties on elements (instead of just the attribute as React does)](https://www.npmjs.com/package/react-property-setter)
- [`<ReactEventEmitter />` to emit events from data in React](https://www.npmjs.com/package/react-event-emitter)

### Vue

A starter example of how to use Nightingale with Vue can be found in the [`examples/basic_vue`](https://github.com/ebi-webcomponents/nightingale/blob/master/examples/basic_vue) directory in the repository.

These are the necessary steps to import and register components in Vue:

1. Ignore the elements you import from Nightingale in the `ignoredElements` configuration parameter of the `Vue` object (failing to perform this step might results in compilation errors).
2. `npm install`, then import and register Nightingale components in the `<script>` section of Vue components:

   ```vue
   <script>
   import ProtvistaSequence from "protvista-sequence";

   window.customElements.define("protvista-sequence", ProtvistaSequence);
   </script>
   ```

You can then use the Nightingale component in the `<template>` section of your Vue Component (in this case, you could use a `<protvista-sequence />` track).

#### Data and event handling

If you want to bind data to attributes of Nightingale components via Vue, you can do it like so:

```vue
<template>
  <protvista-sequence :length="sequence.length" :sequence="sequence" />
</template>

<script>
import ProtvistaSequence from "protvista-sequence";

window.customElements.define("protvista-sequence", ProtvistaSequence);

export default {
  name: "ProtvistaContainer",
  data() {
    return {
      sequence: "SEQVENCE",
    };
  },
};
</script>
```

If you want your Nightingale components to react to events within the Vue environment, you should use `refs` like so:

```vue
<template>
  <protvista-track ref="features" length="350" />
</template>

<script>
import ProtvistaTrack from "protvista-track";

window.customElements.define("protvista-track", ProtvistaTrack);

export default {
  name: "ProtvistaContainer",
  mounted() {
    const features = [
      {
        accession: "NLS",
        start: 1,
        end: 3,
        color: "#d8b365",
      },
    ];

    this.$refs.features.data = features;
  },
};
</script>
```


# Bundling Workflow

All components are exported as modules. This means you can import them as any
other ES6 module in your application:

```js
import NightingaleTrack from "@nightingale-elements/nightingale-track";
```
